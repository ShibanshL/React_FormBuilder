import{r as s,u as ge,a as xe,d as Se,j as e}from"./index-980ec48f.js";import{a as je,c as be,d as ye,u as De,e as Ae}from"./APIREQ-8aa8e91c.js";function Ne(){var q,O,P,k,Q,C,R,I,_,Y,B,L,M,W;const K=window.localStorage.getItem("token"),[n,Z]=s.useState([]),[ee,te]=s.useState([]),se=ge(t=>t.setPage),[ae,T]=s.useState([]),[ie,re]=s.useState(!1),[u,le]=s.useState(""),[D,S]=s.useState(""),[oe,ne]=s.useState(""),[j,ce]=s.useState([]),[h,A]=s.useState(0),[b,ue]=s.useState([]),[c,de]=s.useState([]),[g,p]=s.useState(!1),[v,F]=s.useState(0),[E,fe]=s.useState([]),[f,w]=s.useState([]),[me,d]=s.useState("");let he=xe(),{form_id:x,ac_id:N}=Se();const pe=()=>{var U,z,H,V,X,$,G,J;d(""),p(!0);let t=0,o=0,i=[],r=[],l=(H=(z=(U=n.data)==null?void 0:U.subData)==null?void 0:z.formData)==null?void 0:H.formDataArray,m=/^[^ ]+@[^ ]+\.[a-z]{2,3}$/;if(u)if(u.match(m)){S("true");for(let a=0;a<(($=(X=(V=n.data)==null?void 0:V.subData)==null?void 0:X.formData)==null?void 0:$.formDataArray.length);a++)if(l[a].required){l[a].answerType=="Text"&&(l[a].textAnswer==""||!l[a].textAnswer?(t+=1,r.splice(l[a],0),w(r)):(r.push(l[a]),w(r)));for(let y=0;y<l[a].options.length;y++)l[a].options[y].isSingle_Selected==!0&&(i.push(l[a]),T(i),F(v+1)),l[a].options[y].isSingle_Selected==!1&&(i.splice(l[a],0),T(i),F(v+1))}}else S("false"),d("Please enter a valid mail");else S("false");if(t==0){for(let a=0;a<j.length;a++)u==((J=(G=j[a].sub)==null?void 0:G.data)==null?void 0:J.formEmail)&&(o+=1);o==0&&A(h+1),o!=0&&(h>0&&A(h-1),h<=0&&A(0))}};return s.useEffect(()=>{let t=[];ae.map(o=>{t.includes(o.id)||t.push(o.id)}),de(t.sort())},[v]),s.useEffect(()=>{var i,r,l;let t=[],o=[];n&&((l=(r=(i=n.data)==null?void 0:i.subData)==null?void 0:r.formData)==null||l.formDataArray.map(m=>{m.required&&(m.answerType=="Options"&&t.push(m.id),m.answerType=="Text"&&(o.push(m.id),fe(o)))}),ue(t))},[(P=(O=(q=n.data)==null?void 0:q.subData)==null?void 0:O.formData)==null?void 0:P.formDataArray]),s.useEffect(()=>{je({userDataPre:ee,setLoading:re,ac_id:N,form_id:x,setuserDataPre:te,setuserData:Z}),be({globalToken:K,form_id:x,setFormRes:ce})},[N]),s.useEffect(()=>{if(c.length==0&&f.length==0&&u==""&&d("Please enter your email first"),u!=""){if(c.length==0&&f.length==0&&D=="true")return d("You've not filled any Questions. 00");if(f.length==0||f.length!==E.length)return d("You've missed some of the required questions34");if(c.length==0||c.length!==b.length)return d("You've missed some of the required questions12")}g&&setTimeout(()=>p(!1),3e3)},[g]),s.useEffect(()=>{var o,i;let t=0;for(let r=0;r<j.length;r++)u==((i=(o=j[r].sub)==null?void 0:o.data)==null?void 0:i.formEmail)&&c.length!=0&&f.length!=0&&(t+=1);b.length==c.length&&c.length>0&&h>0&&E.length==f.length&&t==0&&(ye({email:u,userData:n,ac_id:N,form_id:x}),De(x),Ae(x),he("/formSubmit"),p(!1)),t>0&&d("This mail has aleready been used, use a new mail."),(b.length!==c.length||f.length!==E.length)&&d("You've missed some of the required questions")},[b&&c||h]),s.useEffect(()=>se("APP_FORM")),new Date((Q=(k=n==null?void 0:n.data)==null?void 0:k.subData)==null?void 0:Q.formExpiryData)<new Date?e.jsx(e.Fragment,{children:e.jsx("div",{className:"DatePass",children:e.jsx("div",{className:"DatePass_card",children:"Sorry, the form has expired. You missed the form!!"})})}):ie?e.jsx(e.Fragment,{children:e.jsx("div",{className:"Loading",children:e.jsx("h1",{children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"AppForm",children:[e.jsxs("div",{className:"AppFormHeadingTab",children:[e.jsx("h2",{style:{color:"white",fontWeight:500},children:(I=(R=(C=n.data)==null?void 0:C.subData)==null?void 0:R.formQuestion)==null?void 0:I.question}),e.jsx("label",{style:{color:"white",fontWeight:500,marginTop:"10px"},children:(B=(Y=(_=n.data)==null?void 0:_.subData)==null?void 0:Y.formQuestion)==null?void 0:B.description})]}),e.jsxs("div",{className:"AppFormEmail",children:[e.jsxs("div",{className:"AppEmailQuestion",children:[e.jsxs("label",{style:{color:"white",fontWeight:500},children:["Please Enter your email.",e.jsx("div",{className:"ifMobileEm",style:{color:"rgb(216, 61, 30)"},children:"*"})]}),e.jsx("div",{className:"ImpBadgeEmail",children:"REQUIRED"})]}),e.jsx("input",{type:"text",placeholder:"Email",style:D!=""?D!="true"?{border:"3px solid red"}:{border:"none"}:{border:"none"},value:u,onChange:t=>{le(t.target.value),S("true"),p(!1)},autoComplete:"off"})]}),(W=(M=(L=n.data)==null?void 0:L.subData)==null?void 0:M.formData)==null?void 0:W.formDataArray.map((t,o)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"AppFormQuestions",children:[e.jsxs("div",{className:"AppFormLabel",children:[e.jsxs("label",{style:{color:"white",fontWeight:500},children:["Q",o+1,". ",t.question,"?Â ",e.jsx("div",{className:"ifMobile",style:t.required?{color:"rgb(216, 61, 30)"}:{color:"#abc4ff"},children:t.required?"*":""})]}),t.required?e.jsx("div",{className:"ImpBadge",children:"required"}):null]}),t.isOpen?e.jsx(e.Fragment,{children:t.options.map((i,r)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"AppFormOptions",children:[t.multiselect?e.jsx("input",{type:"checkbox",value:i.OptionSub,onClick:()=>{t.multiselect==!0&&(t.options[r].isSelected=t.options[r].isSelected!=!0)}}):e.jsx("input",{type:"checkbox",value:oe,checked:!!t.options[r].isSingle_Selected,onClick:()=>{ne(i.OptionSub)},onChange:l=>{t.options[r].isSingle_Selected=l.target.checked,p(!1)}}),e.jsx("label",{children:i.OptionSub})]})}))}):e.jsx("textarea",{id:"myTxtArea",role:"textbox",placeholder:"Enter your answer",onChange:i=>{t.textAnswer=i.target.value,p(!1)}})]})})),e.jsx("div",{className:"SubmitData",children:e.jsx("button",{onClick:pe,style:g?{opacity:.5}:{opacity:1},disabled:g,children:"Submit"})})]}),e.jsx("div",{className:"AppFormNotif",style:g?{transform:"translate(-50%, -10%)"}:{transform:"translate(-50%, 120%)"},children:e.jsx("div",{className:"AppNotification",children:e.jsx("h2",{children:me})})})]})}export{Ne as default};
